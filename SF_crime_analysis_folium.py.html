#!/usr/bin/env python
# coding: utf-8

# 
# Table of Contents
# 
# 1. Import libraries 
# 2. Perform EDA
# 3. Display the map of San Francisco then add incidents reported to San Francisco Police Department onto the map

# In[1]:


# Import libraries 
import numpy as np 
import pandas as pd 
import folium
from folium import plugins
get_ipython().run_line_magic('matplotlib', 'inline')
import matplotlib as mpl
import matplotlib.pyplot as plt
import seaborn as sns 
import warnings
warnings.filterwarnings('ignore')
warnings.warn('DelftStack')
warnings.warn('Do not show this message')


# Datasets:
# 
# 1.  San Francisco Police Department Incidents for the year 2016 - [Police Department Incidents](https://data.sfgov.org/Public-Safety/Police-Department-Incidents-Previous-Year-2016-/ritf-b9ki?utm_medium=Exinfluencer&utm_source=Exinfluencer&utm_content=000026UJ&utm_term=10006555&utm_id=NA-SkillsNetwork-Channel-SkillsNetworkCoursesIBMDeveloperSkillsNetworkDV0101ENSkillsNetwork20297740-2021-01-01) from San Francisco public data portal. Incidents derived from San Francisco Police Department (SFPD) Crime Incident Reporting system. Updated daily, showing data for the entire year of 2016. Address and location has been anonymized by moving to mid-block or to an intersection.

# In[2]:


df = pd.read_csv('Police_Department_Incidents_2016.csv')
df.head()


# So each row consists of 13 features:
# 
# > 1.  **IncidntNum**: Incident Number
# > 2.  **Category**: Category of crime or incident
# > 3.  **Descript**: Description of the crime or incident
# > 4.  **DayOfWeek**: The day of week on which the incident occurred
# > 5.  **Date**: The Date on which the incident occurred
# > 6.  **Time**: The time of day on which the incident occurred
# > 7.  **PdDistrict**: The police department district
# > 8.  **Resolution**: The resolution of the crime in terms whether the perpetrator was arrested or not
# > 9.  **Address**: The closest address to where the incident took place
# > 10. **X**: The longitude value of the crime location
# > 11. **Y**: The latitude value of the crime location
# > 12. **Location**: A tuple of the latitude and the longitude values
# > 13. **PdId**: The police department ID

# In[3]:


# Pd District count with most incident
print(df['PdDistrict'].value_counts())
plt.figure(figsize=(10,6))
sns.countplot(df['PdDistrict'])


# In[4]:


# top 20 days with the most incidents  
day = df['Date'].value_counts().to_frame()
day['Date'].nlargest(n=20).to_frame()


# In[5]:


daycrime = df['DayOfWeek'].value_counts().to_frame()
print(daycrime)
daycrime['DayOfWeek'].plot(kind='pie',
                            figsize=(15, 6),
                            autopct='%1.1f%%', 
                            startangle=90,    
                            shadow=True,       
                            labels=None,         # turn off labels on pie chart
                            pctdistance=1.12,    # the ratio between the center of each pie slice and the start of the text generated by autopct 
                            )

# scale the title up by 12% to match pctdistance
plt.title('Day of Week Crimes are commited', y=1.12) 
plt.axis('equal') 
plt.legend(labels=daycrime.index, loc='upper left') 
plt.show()


# In[6]:


# get the first 1000 crimes in the df_incidents dataframe
limit = 1000
df_incidents = df.iloc[0:limit, :]


# Display the latitude, longitude and Descript crime types. furthermore add a pop-up text to each marker.

# In[7]:


# San Francisco latitude and longitude values
latitude = 37.77
longitude = -122.42
# create sanfran_map
sanfran_map = folium.Map(location=[latitude, longitude], zoom_start=12)


# instantiate a feature group for the incidents in the dataframe
incidents = folium.map.FeatureGroup()

# loop through the 1000 crimes and add each to the incidents feature group
for lat, lng, in zip(df_incidents.Y, df_incidents.X):
    incidents.add_child(
        folium.features.CircleMarker(
            [lat, lng],
            radius=5, # define how big you want the circle markers to be
            color='yellow',
            fill=True,
            fill_color='blue',
            fill_opacity=0.6
        )
    )

# add pop-up text to each marker on the map
latitudes = list(df_incidents.Y)
longitudes = list(df_incidents.X)
labels = list(df_incidents.Descript)

for lat, lng, label in zip(latitudes, longitudes, labels):
    folium.Marker([lat, lng], popup=label).add_to(sanfran_map)    
    
# add incidents to map
sanfran_map.add_child(incidents)


# Now lets group the markers into different clusters. Each cluster is represented by the number of crimes in each neighborhood. These clusters can be thought of as pockets of San Francisco which you can then analyze separately.

# In[8]:



# let's start again with a clean copy of the map of San Francisco
sanfran_map = folium.Map(location = [latitude, longitude], zoom_start = 12)

# instantiate a mark cluster object for the incidents in the dataframe
incidents = plugins.MarkerCluster().add_to(sanfran_map)

# loop through the dataframe and add each data point to the mark cluster
for lat, lng, label, in zip(df_incidents.Y, df_incidents.X, df_incidents.Descript):
    folium.Marker(
        location=[lat, lng],
        icon=None,
        popup=label,
    ).add_to(incidents)

# display map
sanfran_map


# In[ ]:




